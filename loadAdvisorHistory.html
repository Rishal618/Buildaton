<!DOCTYPE html>
<html>
  <head>
    <title>
      Principal Panel
    </title>

    <link rel="stylesheet" type="text/css" href="styles/principal-screen.css">
    <link rel="stylesheet" type="text/css" href="styles/submitted-letters.css">
  </head>
  <body>



    <div class="status-tabs-principal"> 
      <div class="tab tab-pending" onclick="showTab('pending')">
        <p>Pending</p>
      </div>
      <div class="tab" onclick="showTab('approved')">
        <p>Approved</p>
      </div>
      <div class="tab" onclick="showTab('rejected')">
        <p>Rejected</p>
      </div>
    </div>

    <div class="messages-area">
      <div id="pending" class="messages">
        
      </div>
      <div id="approved" class="messages">
        
      </div>
      <div id="rejected" class="messages">
        
      </div>
    </div>


    <div id="applications"></div>

<script src="js/work-flow.js"></script>
<script>
  
  
  
  function loadAdvisorHistory() {
    let apps = JSON.parse(localStorage.getItem("applications")) || [];;

    let pending = apps.filter(app => app.stage === "Advisor" && app.status === "Pending" );
        
        document.getElementById("pending").innerHTML = pending.length === 0 ? "<p>No pending letters.</p>" : pending.map(a => `
            <div class="approved-letter-div">
            <p class="approved-letter-from"><strong>From:</strong></p><br>
            <p class="approved-letter-from-user">${a.name}</p><br>
            <p class="approved-letter-from-user">${a.department} &nbsp; ${a.year}</p><br>
            <p class="approved-letter-from-user">${a.email}</p><br>
            <p class="approved-letter-from-user">${a.phoneNumber}</p><br>
            <hr>
             <p class="approved-letter-subject"><strong>Subject:</strong> ${a.subject}</p>
            
            
            <p class="approved-letter-body">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${a.body}</p>
            <div class="status-div-pending">Pending</div>
            <div class="approve-reject-button-div">
              <button onclick="updateStatus(${a.id}, 'Approved')" class="approve-button">approve</button>
              <button onclick="updateStatus(${a.id}, 'Rejected')" class="reject-button">reject</button>
            </div>

            </div>


            `
            
            ).join("");


        let rejected = apps.filter(app => app.stage === "completed" && app.status === "Rejected" && app.rejectedAtStage === "Advisor");
        
        document.getElementById("rejected").innerHTML = rejected.length === 0 ? "<p>No rejected letters.</p>" : 
        rejected.map(a => `
           <div class="approved-letter-div">
            <p class="approved-letter-from"><strong>From:</strong></p><br>
            <p class="approved-letter-from-user">${a.name}</p><br>
            <p class="approved-letter-from-user">${a.department} &nbsp; ${a.year}</p><br>
            <p class="approved-letter-from-user">${a.email}</p><br>
            <p class="approved-letter-from-user">${a.phoneNumber}</p><br>
            <hr>
             <p class="approved-letter-subject"><strong>Subject:</strong> ${a.subject}</p>
            
            
            <p class="approved-letter-body">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${a.body}</p>
            
            <div class="status-div-rejected">Rejected</div>
            </div>

            `
            ).join("");


            let approved = apps.filter(app => app.stage === "Advisor" && app.status === "Approved"); 
            document.getElementById("approved").innerHTML = approved.length === 0 ? "<p>No approved letters.</p>" : 
            approved.map(a => `<div class="approved-letter-div">
            <p class="approved-letter-from"><strong>From:</strong></p><br>
            <p class="approved-letter-from-user">${a.name}</p><br>
            <p class="approved-letter-from-user">${a.department} &nbsp; ${a.year}</p><br>
            <p class="approved-letter-from-user">${a.email}</p><br>
            <p class="approved-letter-from-user">${a.phoneNumber}</p><br>
            <hr>
             <p class="approved-letter-subject"><strong>Subject:</strong> ${a.subject}</p>
            
            
            <p class="approved-letter-body">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${a.body}</p>
            
            <div class="status-div-approved">Approved</div>
            </div>

            `
            ).join("");
      
  }

  function showTab(tabId) { document.querySelectorAll('.messages').forEach(div => div.style.display = 'none'); 
  document.getElementById(tabId).style.display = 'block'; 
  }
  loadAdvisorHistory(); 
  showTab('pending');

</script>
 </body>
</html> 